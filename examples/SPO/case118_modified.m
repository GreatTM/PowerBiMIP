%% -------------------------HELLO-------------------------- %%
% 本函数是通用函数，改编的ieee118节点系统，可根据标准算例文件case118生成系统参数
% 主程序运行时只需运行此函数即可，无需导入excel表格
%% -------------------------START-------------------------- %%
function system_data = case118_modified
    %% --------------------------loading----------------------- %%
    mpc = case118; % 载入ieee118节点标准算例系统
    %% --------------------------data-------------------------- %%
    system_data.Sbase = mpc.baseMVA; % 基准功率100MW
    % 将10；19；36；66；90母线上的常规机组换成风电机组
    mpc.gen = [mpc.gen(1:4,:);mpc.gen(6:8,:);mpc.gen(10:11,:);mpc.gen(13:16,:);mpc.gen(18,:);mpc.gen(20:25,:);mpc.gen(27:28,:);mpc.gen(30:31,:);mpc.gen(33:40,:);mpc.gen(42:54,:)];
    mpc.gencost = [mpc.gencost(1:4,:);mpc.gencost(6:8,:);mpc.gencost(10:11,:);mpc.gencost(13:16,:);mpc.gencost(18,:);mpc.gencost(20:25,:);mpc.gencost(27:28,:);mpc.gencost(30:31,:);mpc.gencost(33:40,:);mpc.gencost(42:54,:)];
    system_data.Nbus = 118; % 电网节点数
    system_data.Ngen = 45; % 常规机组数目
    system_data.Nrenewablegen = 9; % 新能源机组数，均为风电
    system_data.Nload = 91; % 负荷数目
    system_data.load_weight = [
        0.011127415;0.009125331;0.009942421;0.012164776;0.011082586;
        0.009581312;0.01153976;0.009838587;0.010899123;0.00853348;
        0.013127886;0.011255913;0.012290697;0.012258637;0.010452759;
        0.010792529;0.011090855;0.011899053;0.010567023;0.011048739;
        0.010763991;0.013458927;0.011565582;0.010890186;0.00912895;
        0.009173968;0.01003117;0.008360027;0.010085097;0.009251321;
        0.012717277;0.013018267;0.011766943;0.013041022;0.008349365;
        0.01288359;0.011319944;0.010955853;0.010720225;0.009559404;
        0.010327043;0.012107224;0.00908951;0.013007931;0.008583716;
        0.012724369;0.010751695;0.009179088;0.009870722;0.011324968;
        0.010649926;0.010558826;0.010543054;0.012030236;0.009327605;
        0.011548806;0.009849705;0.010901999;0.008271711;0.013949281;
        0.009488789;0.011783187;0.01017492;0.014137625;0.011022752;
        0.010351864;0.011615373;0.013490469;0.008587458;0.012605937;
        0.010388386;0.012180585;0.009605362;0.010947958;0.010721342;
        0.011602739;0.013955942;0.013569704;0.012922269;0.008281373;
        0.011547969;0.010840894;0.012903583;0.011655824;0.010601577;
        0.009669706;0.011473522;0.011556005;0.011282066;0.010470585;
        0.010307275
    ]; % 每个城市所占的负荷比例
    system_data.load_bus = [
        1;2;3;4;6;7;11;12;13;14;
        15;16;17;18;19;20;21;22;23;27;
        28;29;31;32;33;34;35;36;39;40;
        41;42;43;44;45;46;47;48;49;50;
        51;52;53;54;55;56;57;58;59;60;
        62;66;67;70;74;75;76;77;78;79;
        80;82;83;84;85;86;88;90;92;93;
        94;95;96;97;98;100;101;102;103;
        104;105;106;107;108;109;110;112;
        114;115;117;118
    ]; % 每个城市所在的母线
    system_data.gen_bus = mpc.gen(:,1); % 常规机组所在节点编号
    system_data.renewablegen_bus = [10;19;26;36;42;61;66;72;90]; % 新能源机组所在节点编号
    system_data.RES_weight = [
        0.1; 0.17; 0.2; 0.1; 0.08; 0.05; 0.1; 0.05; 0.15];
    system_data.cost.c0 = mpc.gencost(:,7) / system_data.Sbase; % 机组成本曲线常数项
    system_data.cost.c1 = mpc.gencost(:,6); % 机组成本曲线一次项
    system_data.cost.c2 = mpc.gencost(:,5); % 机组成本曲线二次项
    system_data.cost.startup = mpc.gencost(:,2) / system_data.Sbase; % 机组开机成本
    system_data.cost.shutdown = mpc.gencost(:,3) / system_data.Sbase; % 机组停机成本
    system_data.plimit.upper = mpc.gen(:,9) / system_data.Sbase; % 机组出力上限
    system_data.plimit.lower = mpc.gen(:,10) / system_data.Sbase; % 机组出力下限
    system_data.resplimit.upper = ones(9,1)*200 / system_data.Sbase;
    system_data.ramplimit.up =   0.2 * system_data.plimit.upper; % 常规机组爬坡上限
    system_data.ramplimit.down = 0.2 * system_data.plimit.upper; % 常规机组爬坡下限
    system_data.ramplimit.sup = 0.5 * (system_data.plimit.upper + system_data.plimit.lower); % 常规机组启动最大爬坡
    system_data.ramplimit.sdown = 0.5 * (system_data.plimit.upper + system_data.plimit.lower); % 常规机组关机最大爬坡
    system_data.mintime.on =     3 * ones(49,1); % 最小开启时间
    system_data.mintime.off =    3 * ones(49,1); % 最小停机时间
    system_data.pbranchlimit.upper = [
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000;1000;1000;1000;1000;
        1000;1000;1000;1000;1000;1000
    ] / system_data.Sbase*2; % 支路潮流上限
    system_data.pbranchlimit.lower = [
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;-1000;
        -1000;-1000;-1000;-1000;-1000;-1000
    ] / system_data.Sbase*2; % 支路潮流下限
    PTDF = round(makePTDF(mpc), 4); % 计算转移系数（行：to line 列：from bus）
    system_data.PTDF.gen = PTDF(:,system_data.gen_bus); % 机组所在对应的转移系数
    system_data.PTDF.renewablegen = PTDF(:,system_data.renewablegen_bus); % 新能源机组所在节点对应的转移系数
    system_data.PTDF.load = PTDF(:,system_data.load_bus); % 负荷所在节点对应的转移系数
    system_data.cost.compensation_up = system_data.cost.c1*10;
    system_data.cost.compensation_down = system_data.cost.c1*(-0.5);
%     system_data.cost.compensation_up =  2 * (2 * system_data.cost.c2 .* system_data.plimit.upper + ...
%         system_data.cost.c1); % 常规机组向上调频成本
%     system_data.cost.compensation_down = 0.5 * (2 * system_data.cost.c2 .* system_data.plimit.upper + ...
%         system_data.cost.c1); % 常规机组向下调频成本
end